import com.github.jengelman.gradle.plugins.shadow.transformers.ApacheNoticeResourceTransformer

plugins {
    id 'com.github.johnrengelman.shadow' version '5.2.0'
}

description = 'Standalone keycloak-mock server for use in frontend development'

shadowJar {
    classifier null
    manifest {
        attributes 'Main-Class': 'com.tngtech.keycloakmock.standalone.Main'
    }
    exclude 'META-INF/LICENSE.*'
    transform(ApacheNoticeResourceTransformer.class) {
        addHeader = true
        encoding = 'UTF-8'
        inceptionYear = 2019
        organizationName = company_name
        organizationURL = company_url
        projectName = 'Keycloak Mock Standalone'
    }
    metaInf {
        from "${rootDir}/NOTICE", "${rootDir}/LICENSE"
    }
}

task fakeJar(type: Jar) {
    from file("${project.projectDir}/src/main/resources/README.md")
    classifier 'fake'
}

publishing {
    publications {
        shadow(MavenPublication) {
            publication -> project.shadow.component(publication)
            artifact(fakeJar) {
                classifier 'javadoc'
            }
            artifact(fakeJar) {
                classifier 'sources'
            }
        }
    }
}

signing {
    sign publishing.publications.shadow
}

dependencies {
    implementation project(':mock')
    implementation "info.picocli:picocli:$picocli_version"
    implementation "io.vertx:vertx-web:$vertx_version"
    implementation "io.vertx:vertx-web-templ-freemarker:$vertx_version"
}

configurations {
    all*.exclude group: 'javax.servlet'
}
